;;; Terminal Turtles 2500.  -*- lisp -*-

(in-package :minsky-forth)

(setq *read-base* 2.)

(defparameter *game-font* '(
		(start #o170000)

		(0000000000000000 & 000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 001)
		(0000000000000000)
		(0000001100000001)
		(0000011000000111)
		(0000000100000101)
		(0000011000000001)
		(0000011100000111)
		(0000011100000111)

		(0000000000000000 & 002)
		(0000000000000000)
		(0000000000000000)
		(1110011100000000)
		(1110011111100111)
		(1110011111100111)
		(1011110100011000)
		(1011110110111101)

		(0000000000000000 & 003)
		(0000000000000000)
		(1100000010000000)
		(0110000011100000)
		(1000000010100000)
		(0110000010000000)
		(1110000011100000)
		(1110000011100000)

		(0000000000000000 & 004)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000011000000111 & 005)
		(0111101111110001)
		(0001111000111101)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0001100010111101 & 006)
		(1110011111100111)
		(0110011011100111)
		(0011110000000000)
		(0111111001111110)
		(0001100000111100)
		(0000000000000000)
		(0000000000000000)

		(0110000011100000 & 007)
		(1101111010001111)
		(0111100010111100)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 010)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 011)
		(0000000000000000)
		(0000000100000000)
		(0000001100000011)
		(0000000000000010)
		(0000001100000000)
		(0000001100000011)
		(0000001100000011)

		(0000000000000000 & 012)
		(0000000000000000)
		(1000000010000000)
		(0111001110000000)
		(1111001111110011)
		(0111001111110011)
		(1101111010001100)
		(1101111011011110)

		(0000000000000000 & 013)
		(0000000000000000)
		(0110000001000000)
		(1011000001110000)
		(1100000011010000)
		(1011000011000000)
		(1111000001110000)
		(1111000011110000)

		(0000000000000000 & 014)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000001100000011 & 015)
		(0011110101111000)
		(0000111100011110)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000110011011110 & 016)
		(1111001111110011)
		(0011001111110011)
		(0001111000000000)
		(0011111100111111)
		(0000110000011110)
		(0000000000000000)
		(0000000000000000)

		(0011000011110000 & 017)
		(1110111111000111)
		(0011110011011110)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 020)
		(0000000010000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 021)
		(0000000000000000)
		(0000000000000000)
		(0000000100000001)
		(0000000000000001)
		(0000000100000000)
		(0000000100000001)
		(0000000100000001)

		(0000000000000000 & 022)
		(0000000000000000)
		(1100000001000000)
		(1011100111000000)
		(0111100101111001)
		(1011100101111001)
		(1110111111000110)
		(1110111111101111)

		(0000000000000000 & 023)
		(0000000000000000)
		(0011000000100000)
		(1101100000111000)
		(1110000011101000)
		(1101100011100000)
		(0111100000111000)
		(0111100001111000)

		(0000000000000000 & 024)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000100000001 & 025)
		(0001111000111100)
		(0000011100001111)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(1000011011101111 & 026)
		(1111100101111001)
		(1001100101111001)
		(0000111100000000)
		(0001111100011111)
		(0000011000001111)
		(0000000000000000)
		(0000000000000000)

		(0001100001111000 & 027)
		(1111011111100011)
		(1001111011101111)
		(0000000000000000)
		(1000000010000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 030)
		(1000000011000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 031)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 032)
		(0000000000000000)
		(0110000000100000)
		(1101110011100000)
		(0011110010111100)
		(1101110000111100)
		(1111011111100011)
		(1111011111110111)

		(0000000000000000 & 033)
		(0000000000000000)
		(0001100000010000)
		(1110110000011100)
		(1111000011110100)
		(1110110011110000)
		(1011110000011100)
		(1011110010111100)

		(0000000000000000 & 034)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 035)
		(0000111100011110)
		(0000001100000111)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(1100001111110111 & 036)
		(0111110000111100)
		(1100110010111100)
		(0000011100000000)
		(0000111100001111)
		(0000001100000111)
		(0000000000000000)
		(0000000000000000)

		(0000110010111100 & 037)
		(1111101111110001)
		(1100111111110111)
		(1000000000000000)
		(1100000011000000)
		(0000000010000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 040)
		(1100000011100000)
		(0000000010000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 041)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 042)
		(0000000000000000)
		(0011000000010000)
		(0110111001110000)
		(0001111001011110)
		(0110111000011110)
		(0111101101110001)
		(0111101101111011)

		(0000000000000000 & 043)
		(0000000000000000)
		(0000110000001000)
		(0111011000001110)
		(0111100001111010)
		(0111011001111000)
		(1101111010001110)
		(1101111011011110)

		(0000000000000000 & 044)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 045)
		(0000011100001111)
		(0000000100000011)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0110000101111011 & 046)
		(1011111000011110)
		(1110011011011110)
		(0000001100000000)
		(0000011100000111)
		(0000000100000011)
		(0000000000000000)
		(0000000000000000)

		(1000011011011110 & 047)
		(0111110101111000)
		(0110011101111011)
		(1100000000000000)
		(1110000011100000)
		(1000000011000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 050)
		(1110000011110000)
		(1000000011000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 051)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 052)
		(0000000000000000)
		(0001100000001000)
		(0011011100111000)
		(0000111100101111)
		(0011011100001111)
		(0011110100111000)
		(0011110100111101)

		(0000000000000000 & 053)
		(0000000000000000)
		(0000011000000100)
		(0011101100000111)
		(0011110000111101)
		(0011101100111100)
		(1110111111000111)
		(1110111111101111)

		(0000000000000000 & 054)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 055)
		(0000001100000111)
		(0000000000000001)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0011000000111101 & 056)
		(1101111110001111)
		(1111001111101111)
		(0000000100000000)
		(0000001100000011)
		(0000000000000001)
		(0000000000000000)
		(0000000000000000)

		(1100001111101111 & 057)
		(0011111000111100)
		(0011001100111101)
		(1110000000000000)
		(1111000011110000)
		(1100000011100000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 060)
		(1111000001111000)
		(1100000011100000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 061)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 062)
		(0000000000000000)
		(0000110000000100)
		(0001101100011100)
		(0000011100010111)
		(0001101100000111)
		(0001111000011100)
		(0001111000011110)

		(0000000000000000 & 063)
		(0000000000000000)
		(0000001100000010)
		(1001110100000011)
		(1001111010011110)
		(1001110110011110)
		(1111011101100011)
		(1111011111110111)

		(0000000000000000 & 064)
		(0000000000000000)
		(0000000000000000)
		(1000000010000000)
		(0000000010000000)
		(1000000000000000)
		(1000000010000000)
		(1000000010000000)

		(0000000000000000 & 065)
		(0000000100000011)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0001100000011110 & 066)
		(1110111111000111)
		(0111100111110111)
		(0000000000000000)
		(0000000100000001)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0110000111110111 & 067)
		(1001111110011110)
		(1001100110011110)
		(1111000000000000)
		(1111100011111000)
		(0110000011110000)
		(0000000000000000)
		(0000000000000000)

		(1000000010000000 & 070)
		(0111100000111100)
		(1110000011110000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 071)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000000000000000 & 072)
		(0000000000000000)
		(0000011000000010)
		(0000110100001110)
		(0000001100001011)
		(0000110100000011)
		(0000111100001110)
		(0000111100001111)

		(0000000000000000 & 073)
		(0000000000000000)
		(0000000100000001)
		(1100111000000001)
		(1100111111001111)
		(1100111011001111)
		(0111101100110001)
		(0111101101111011)

		(0000000000000000 & 074)
		(0000000000000000)
		(1000000000000000)
		(1100000011000000)
		(0000000001000000)
		(1100000000000000)
		(1100000011000000)
		(1100000011000000)

		(0000000000000000 & 075)
		(0000000000000001)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000110000001111 & 076)
		(1111011111100011)
		(0011110001111011)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0011000001111011 & 077)
		(1100111111001111)
		(1100110011001111)
		(0111100000000000)
		(1111110011111100)
		(0011000001111000)
		(0000000000000000)
		(0000000000000000)

		(1100000011000000 & 100)
		(1011110000011110)
		(1111000001111000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0000001000000001 & 101)
		(0000100000000100)
		(0011111100010000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)

		(0100000010000000 & 102)
		(0001000000100000)
		(1111110000001000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
		(0000000000000000)
))

(setq *read-base* 8.)

(defparameter *game-code* '(
                (call 40 line)
                (call 41 turtle-shift)
                (call 42 frame-count)
                (call 43 player-pos)
                (call 44 turtles-pos)
                (call 1000 line-start)

		(start 100)
		(pushj init)

main-loop	(pushj check-ints)
                (pushj check-flags)
		(jump main-loop)

init		(lod 0)
		(12000)
		(put 0 dsr)
                (lod 0)
                (35.)
		(put 0 player-pos)
                (lod 0)
		(-15.)
                (put 0 turtles-pos)
                (lod 0)
                (pushj turtles-right)
                (lod 1)
                (turtles-move)
		(nop 1)
		(cwrite 0)
		(lod 0)
		(line-start)
		(put 0 line)
		(lod 1)
		(-5.)
                (put 1 xr)

		(lod 0)
                (1)
                (put 0 50)
		(lod 0)
                (2)
                (put 0 51)
		(lod 0)
                (3)
                (put 0 52)
		(lod 0)
                (4)
                (put 0 53)

                (sub 5 5)
init-loop	(lod 1)
		(1)
		(lod 2)
		(2)
		(lod 3)
		(3)
		(lod 4)
		(4)
		(pushj init-line)
		(lod 1)
		(5)
		(lod 2)
		(6)
		(lod 3)
		(7)
		(lod 4)
		(8.)
                (pushj init-line)
		(bxsi init-loop)

                (pushj tv-page)
		(popj)

init-line	(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
                (writei 0 1)
                (writei 0 2)
                (writei 0 3)
                (writei 0 4)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
		(writei 0 5)
                (popj)

check-flags	(dis flags 1)
                (popj)
		(jump keyboard)
                (popj)

keyboard	(get 0 key)
                (andi 0 0)
		(377)
		(cmpi 0)
		(152 & j)
                (beq player-left)
		(cmpi 0)
		(153 & k)
                (beq player-right)
                (popj)
player-left	(get 0 player-pos)
		(cmpi 0)
		(0)
		(beq player-done)
		(dec 0)
		(jump player-done)
player-right	(get 0 player-pos)
		(cmpi 0)
		(71.)
		(beq player-done)
		(inc 0)
player-done	(put 0 player-pos)
		(popj)		

check-ints	(dis ints 5)
		(popj)
		(jump tv-line)
                (nop)
                (jump tv-line)
                (jump tv-page)
                (jump tv-line)

tv-line		(popj & This is runtime patched.)

tv-line-1	(pushj turtle-line)
		(lod 0)
		(jump tv-line-2)
		(jump next-line)
tv-line-2	(pushj turtle-line)
		(lod 0)
		(jump tv-line-3)
		(jump next-line)
tv-line-3	(pushj turtle-line)
		(lod 0)
		(jump tv-line-4)
		(jump next-line)
tv-line-4	(pushj turtle-line)
		(lod 0)
		(jump tv-line-5)
		(jump next-line)
tv-line-5	(pushj turtle-line)
		(lod 0)
		(jump tv-line-6)
		(jump next-line)
tv-line-6	(pushj turtle-line)
		(lod 0)
		(jump tv-line-7)
		(jump next-line)
tv-line-7	(pushj turtle-line)
		(lod 0)
		(jump tv-line-8)
		(jump next-line)
tv-line-8	(pushj turtle-line)
		(lod 0)
		(jump tv-line-9)
		(jump next-line)
tv-line-9	(pushj turtle-line)
		(lod 0)
		(jump tv-line-10)
		(jump next-line)
tv-line-10	(pushj turtle-line)
		(lod 0)
		(jump tv-line-11)
		(jump next-line)
tv-line-11	(pushj turtle-line)
		(lod 0)
		(jump tv-line-12)
		(jump next-line)
tv-line-12	(pushj turtle-line)
		(lod 0)
		(jump tv-line-13)
		(jump next-line)
tv-line-13	(pushj blank-line)
		(lod 0)
		(jump tv-line-14)
		(jump next-line)
tv-line-14	(pushj blank-line)
		(lod 0)
		(jump tv-line-15)
		(jump next-line)
tv-line-15	(pushj blank-line)
		(lod 0)
		(jump tv-line-16)
		(jump next-line)
tv-line-16	(pushj blank-line)
		(lod 0)
		(jump tv-line-17)
		(jump next-line)
tv-line-17	(pushj blank-line)
		(lod 0)
		(jump tv-line-18)
		(jump next-line)
tv-line-18	(pushj blank-line)
		(lod 0)
		(jump tv-line-19)
		(jump next-line)
tv-line-19	(pushj blank-line)
		(lod 0)
		(jump tv-line-20)
		(jump next-line)
tv-line-20	(pushj blank-line)
		(lod 0)
		(jump tv-line-21)
		(jump next-line)
tv-line-21	(pushj blank-line)
		(lod 0)
		(jump tv-line-22)
		(jump next-line)
tv-line-22	(pushj blank-line)
		(lod 0)
		(jump tv-line-23)
		(jump next-line)
tv-line-23	(pushj blank-line)
		(lod 0)
		(jump tv-line-24)
		(jump next-line)
tv-line-24	(pushj blank-line)
		(lod 0)
		(jump tv-line-25)
		(jump next-line)
tv-line-25	(pushj blank-line)
		(lod 0)
		(jump tv-line-26)
		(jump next-line)
tv-line-26	(pushj blank-line)
		(lod 0)
		(jump tv-line-27)
		(jump next-line)
tv-line-27	(pushj blank-line)
		(lod 0)
		(jump tv-line-28)
		(jump next-line)
tv-line-28	(pushj blank-line)
		(lod 0)
		(jump tv-line-29)
		(jump next-line)
tv-line-29	(pushj player-line)
		(lod 0)
		(jump tv-line-30)
		(jump next-line)
tv-line-30	(jump blank-line)

turtle-line	(get 0 turtles-pos)
		(pushj blanks)
		(pushj turtles)
		(get 1 turtles-pos)
                (addi 1 1)
		(31.)
		(sub 0 0)
		(sub 0 1)
		(pushj blanks)

                (get 0 50)
                (dec 0)
		(addi 0 0)
		(4)
		(andi 0 0)
                (7)
                (inc 0 0)
		(put 0 50)
                (get 0 51)
                (dec 0)
		(addi 0 0)
		(4)
		(andi 0 0)
                (7)
                (inc 0 0)
		(put 0 51)
                (get 0 52)
                (dec 0)
		(addi 0 0)
		(4)
		(andi 0 0)
                (7)
                (inc 0 0)
		(put 0 52)
                (get 0 53)
                (dec 0)
		(addi 0 0)
		(4)
		(andi 0 0)
                (7)
                (inc 0 0)
		(put 0 53)

		(popj)

player-line	(get 1 player-pos)
                (sub 0 0)
                (sub 0 1)
		(pushj blanks)
		(lod 0)
		(101)
                (chartv 0)
		(lod 0)
		(102)
		(chartv 0)
                (get 1 player-pos)
		(subi 1 1)
		(70.)
                (sub 0 0)
                (sub 0 1)
		(jump blanks)

blank-line	(lod 0)
		(-72.)
blanks		(put 0 xr)
		(sub 0 0)
b-loop		(chartv 0)
		(bxsi b-loop)
		(popj)

turtles		(lod 0)
		(-9.)
                (put 0 xr)
t-loop		(get 0 50)
                (get 1 turtle-shift)
                (add 0 1)
		(chartv 0)
		(get 0 51)
                (add 0 1)
		(chartv 0)
		(get 0 52)
                (add 0 1)
		(chartv 0)
		(get 0 53)
                (add 0 1)
		(chartv 0)
		(bxsi t-loop)
		(popj)

tv-page		(sub 0 0)
		(put 0 scroll)
		(lod 0)
		(line-start)
		(put 0 line)
                (get 1 frame-count)
		(inc 1)
                (cmpi 1 1)
                (5.)
                (bne tv-done)
turtles-move	(nop 0 & Patched later.)
                (sub 1 1)
tv-done		(put 1 frame-count)

                (lod 0)
                (jump tv-line-1)
next-line       (lod 1)
                (tv-line)
		(nop 1)
		(cwrite 0)
		(popj)

turtles-right	(get 0 turtle-shift)
                (addi 0 0)
                (10)
                (andi 0 0)
                (70)
                (put 0 turtle-shift)
                (cmpi 0)
		(0)
		(bne tr-done)
                (get 0 turtles-pos)
		(dec 0)
                (put 0 turtles-pos)
		(cmpi 0 0)
		(-20.)
                (bne tr-done)
                (lod 0)
                (pushj turtles-left)
                (lod 1)
                (turtles-move)
		(nop 1)
		(cwrite 0)
tr-done		(popj)

turtles-left	(get 0 turtle-shift)
                (addi 0 0)
                (-10)
                (andi 0 0)
                (70)
                (put 0 turtle-shift)
                (cmpi 0)
		(70)
		(bne tl-done)
                (get 0 turtles-pos)
		(inc 0)
                (put 0 turtles-pos)
		(cmpi 0 0)
		(-10.)
                (bne tl-done)
                (lod 0)
                (pushj turtles-right)
                (lod 1)
                (turtles-move)
		(nop 1)
		(cwrite 0)
tl-done		(popj)
))

#|
16. 1. 16.   16.  4. 16.
16. 5. 16.   16. 10. 16.



lod 0
(16.)
pushj blanks
pushj turtles
lod 0
(16.)
pushj blanks

|#

(defparameter *game-data* '(
		(start 1000)
))

(setq *read-base* 10.)

(defparameter *turtle*
  '(#b00000000000000000000000000000000
    #b00000000000000000000000000000000
    #b00000000000000000000000000000000
    #b00000000000000000000000000000000
    #b00000001000000001000000000000000
    #b00000011000000001100000000000000
    #b00000111000000001110000000000000
    #b00000110111001110110000000000000
    #b00000101111001111010000000000000
    #b00000001111001111000000000000000
    #b00000001111001111000000000000000
    #b00000110111001110110000000000000
    #b00000111000110001110000000000000
    #b00000111101111011110000000000000
    #b00000111101111011110000000000000
    #b00000111101111011110000000000000
    #b00000111101111011110000000000000
    #b00000110000110000110000000000000
    #b11110001111001111000111100000000
    #b01111011111001111101111000000000
    #b00111101111001111011110000000000
    #b00011110011001100111100000000000
    #b00000000000000000000000000000000
    #b00000000001111000000000000000000
    #b00000000011111100000000000000000
    #b00000000011111100000000000000000
    #b00000000001111000000000000000000
    #b00000000000110000000000000000000
    #b00000000000000000000000000000000
    #b00000000000000000000000000000000
    #b00000000000000000000000000000000
    #b00000000000000000000000000000000))

(defun turtle-font ()
  (dotimes (shift 8)
    (dotimes (row 2)
      (dotimes (character 4)
        (dotimes (word 8)
          (let* ((x0 (+ (* 2 word) (* row 16)))
                 (x1 (ash (nth x0 *turtle*) (- shift)))
                 (x5 (- 24 (* character 8)))
                 (x2 (ldb (byte 8 x5) x1))
                 (x3 (ash (nth (1+ x0) *turtle*) (- shift)))
                 (x4 (ldb (byte 8 x5) x3)))
            (format t "~&		(~8,'0B~8,'0B" x4 x2)
            (if (zerop word)
                (format t " & ~3,'0O)~%" (+ 1 character (* 4 row) (* 8 shift))) 
                (format t ")~%"))))
        (terpri)))))
 
(defun build-game ()
  (load "src/MinskyForth/invaders.asm")
  (with-open-file (*standard-output* "src/MinskyForth/game.ascii"
                   :direction :output :if-exists :supersede)
    (format t "\"TERMINAL TURTLES 2500\"~%~%")
    (format t "Code.~%")
    (ascii (assemble *game-code*)
           :loader t   :address #o100    :type 1 :start nil)
    (format t "~&~%Font.~%")
    (ascii (assemble *game-font*)
           :loader nil :address #o170000 :type 2 :start t)
    (terpri)))
